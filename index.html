<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Equb App</title>

  <!-- Material Symbols -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-lang="en" data-theme="light">
  <div class="app-container">
    <div id="particles"></div>
    <div id="toast-container" role="status" aria-live="polite"></div>
    <canvas id="confetti-canvas" style="position:fixed;top:0;left:0;pointer-events:none;z-index:9999;display:none;" aria-hidden="true"></canvas>

    <!-- Confirmation Dialog -->
    <div id="confirmation-dialog" class="confirmation-dialog hidden">
      <h3 id="confirmation-title">Confirm Action</h3>
      <p id="confirmation-message">Are you sure you want to proceed?</p>
      <div class="dialog-buttons">
        <button class="glass-button" id="confirmation-yes">Yes</button>
        <button class="glass-button secondary" id="confirmation-no">No</button>
      </div>
    </div>

    <!-- ====================== PAGES ====================== -->
    <!-- Welcome -->
    <section id="welcome-page" class="page active" aria-labelledby="welcome-title">
      <div class="glass-card center-card welcome-container">
<img src="logo.png" alt="Equb logo" class="welcome-logo" width="100" height="100" />        <h1 id="welcome-title" data-key="welcomeTitle">Equb</h1>
        <p id="welcome-sub" data-key="welcomeSub">Community Savings, Together.</p>
        
        <!-- Language Selector for Welcome Page -->
        <div class="language-selector-container">
          <label for="welcome-language-select" class="form-label" data-key="language">Language</label>
          <select id="welcome-language-select" class="form-field" aria-label="Select language">
            <option value="en">English</option>
            <option value="am">አማርኛ</option>
          </select>
        </div>
        
        <button class="glass-button welcome-button" type="button" onclick="showPage('profile')">
          <span data-key="getStarted">Get Started</span>
        </button>
      </div>
    </section>

    <!-- Home -->
    <section id="home-page" class="page" style="display:none;" aria-labelledby="equb-name">
      <div class="glass-card">
        <h1 id="equb-name"></h1>
        <p><span data-key="goal">Goal:</span> <span id="home-goal-amount"></span> <span data-key="ETB">ETB</span></p>
        <p><span data-key="members">Members:</span> <span id="members-count"></span>/<span id="home-target-members"></span></p>
        <p><span data-key="contribution">Contribution:</span> <span id="home-contribution-amount"></span> <span data-key="ETBEach">ETB each</span></p>

        <div class="progress-container" aria-label="Progress toward goal">
          <svg class="progress-ring" viewBox="0 0 200 200" role="img" aria-label="Equb progress ring">
            <defs>
              <linearGradient id="progress-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#f97316"/>
                <stop offset="50%" stop-color="#0f766e"/>
                <stop offset="100%" stop-color="#06b6d4"/>
              </linearGradient>
            </defs>
            <circle class="progress-bg" cx="100" cy="100" r="90"/>
            <circle class="progress-fg" cx="100" cy="100" r="90"/>
          </svg>
          <div class="progress-center">
            <div class="progress-percent" id="progress-percent"></div>
            <div class="progress-remaining" id="progress-remaining"></div>
          </div>
        </div>
           <!-- Payment Gating Notice -->
        <div id="payment-notice" class="payment-notice" style="display: none;">
          <span data-key="completeProgress">Complete 100% progress to enable payments</span>
        </div>

              <!-- Payment Status for All Frequencies -->
      <div id="payment-status-section" class="glass-card" style="margin-top: 20px;">
        <h2 id="payment-period-title">Payment Status</h2>
        <p>Current Period: <span id="current-period"></span></p>
        <div id="payments-list" class="payments-vertical-list" aria-live="polite">
          <!-- Payment status will be dynamically inserted here -->
        </div>
      </div>

        <span id="status"></span>
        <p><span data-key="round">Round:</span> <span id="current-round"></span> <span data-key="of">of</span> <span id="total-rounds"></span></p>
      </div>

     
     

      <div class="action-buttons" role="group" aria-label="Home actions">
        <button class="gradient-button" type="button" onclick="showModal('contribute')" id="contribute-button">
          <span data-key="contribution">Contribution</span>
        </button>
        <button class="gradient-button" type="button" onclick="showPage('members')">
          <span data-key="members">Members</span>
        </button>
        <button class="gradient-button" type="button" onclick="showModal('create-equb')">
          <span data-key="newEqub">New Equb</span>
        </button>
        <button class="gradient-button" type="button" onclick="showModal('payout')" id="payout-button">
          <span data-key="payout">Payout</span>
        </button>
      </div>
    </section>

    <!-- My Equbs -->
    <section id="myequbs-page" class="page" style="display:none;" aria-labelledby="myequbs-title">
      <h1 id="myequbs-title" data-key="myEqubs">My Equbs</h1>
      <div id="equb-list" class="scroll-list" role="list"></div>
      <p id="no-equbs" class="empty-state" aria-live="polite"></p>

      <div class="glass-card">
        <h2 data-key="explore">Explore</h2>
        <div class="button-group" role="group" aria-label="Equb explore actions">
          <button class="glass-button" type="button" onclick="showModal('create-equb')">
            <span data-key="createEqub">Create Equb</span>
          </button>
          <button class="glass-button" type="button" onclick="showModal('join-equb')">
            <span data-key="joinEqub">Join Equb</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Members -->
    <section id="members-page" class="page" style="display:none;" aria-labelledby="members-title">
      <h1 id="members-title" data-key="members">Members</h1>
      <div id="member-list" class="scroll-list" role="list"></div>
      <p id="no-members" class="empty-state" aria-live="polite"></p>

      <div class="action-buttons" role="group" aria-label="Member actions">
        <button class="glass-button" type="button" onclick="showModal('add-member')">
          <span data-key="addMember">Add Member</span>
        </button>
        <button class="glass-button" type="button" onclick="showModal('edit-payout-order')">
          <span data-key="editPayoutOrder">Edit Payout Order</span>
        </button>
      </div>
    </section>

    <!-- Activity -->
    <section id="activity-page" class="page" style="display:none;" aria-labelledby="activity-title">
      <div class="feed">
        <h1 id="activity-title" style="text-align:center;margin:10px 0;" data-key="activity">Activity Feed</h1>
        <div id="activity-feed" role="list"></div>
        <p id="no-activity" class="empty-state" aria-live="polite"></p>
      </div>
    </section>

    <!-- Profile -->
    <section id="profile-page" class="page" style="display:none;" aria-labelledby="profile-title">
      <!-- Auth Card -->
      <div id="auth-card" class="glass-card" role="form" aria-describedby="auth-help">
        <h1 id="auth-title"></h1>
        <p id="auth-help" class="sr-only">Use the form below to login or sign up</p>

        <!-- Language Selector for Login/Signup -->
        <div class="language-selector-container">
          <label for="auth-language-select" class="form-label" data-key="language">Language</label>
          <select id="auth-language-select" class="form-field" aria-label="Select language">
            <option value="en">English</option>
            <option value="am">አማርኛ</option>
          </select>
        </div>

        <!-- Fixed: Added proper labels for all form fields -->
        <div class="form-row">
          <label for="auth-name" class="form-label" data-key="nameSignup">Name (Signup only)</label>
          <input id="auth-name" class="form-field" style="display:none;" autocomplete="name" placeholder="Enter your name"/>
        </div>

        <div class="form-row">
          <label for="auth-email" class="form-label" data-key="emailPhone">Email or Phone</label>
          <input id="auth-email" class="form-field" autocomplete="email" inputmode="email" placeholder="Enter email or phone"/>
        </div>

        <div class="form-row">
          <label for="auth-password" class="form-label" data-key="password">Password</label>
          <input id="auth-password" type="password" class="form-field" autocomplete="current-password" placeholder="Enter password"/>
        </div>

        <div class="form-row">
          <label for="auth-confirm" class="form-label" data-key="confirmPassword" style="display:none;">Confirm Password</label>
          <input id="auth-confirm" style="display:none;" type="password" class="form-field" autocomplete="new-password" placeholder="Confirm password"/>
        </div>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="authAction()">
            <span data-key="submit">Submit</span>
          </button>
          <button class="glass-button secondary auth-switch-button" type="button" onclick="toggleAuthMode()">
            <span data-key="switchTo">Switch to</span>
            <span id="auth-switch"></span>
          </button>
        </div>
      </div>

      <!-- Profile Card -->
      <div id="profile-card" class="glass-card hidden" aria-labelledby="profile-name">
        <div style="text-align:center;">
          <div id="profile-pic-container" style="width:100px;height:100px;margin:0 auto 15px;border-radius:50%;overflow:hidden;background:#ccc;">
            <img id="profile-pic" src="" alt="Profile photo" style="width:100%;height:100%;object-fit:cover;display:none;"/>
            <div id="profile-pic-placeholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:2em;" aria-hidden="true">?</div>
          </div>
          <label for="upload-pic" class="glass-button small" style="cursor:pointer;" aria-label="Upload profile photo">
            <span data-key="uploadPhoto">Upload Photo</span>
            <input type="file" id="upload-pic" accept="image/*" style="display:none;"/>
          </label>
        </div>
        <h1 id="profile-name"></h1>
        <span id="member-since"></span>
      </div>

      <!-- History Card -->
      <div id="history-card" class="glass-card hidden" aria-labelledby="history-title">
        <h2 id="history-title" data-key="history">History</h2>
        <div id="history-list" class="feed" role="list"></div>
        <p id="no-history" class="empty-state" aria-live="polite"></p>
      </div>

      <!-- Settings Card -->
      <div id="settings-card" class="glass-card hidden settings-container" aria-labelledby="settings-title">
        <h2 id="settings-title" data-key="settings">Settings</h2>

        <div class="setting-item">
          <span data-key="darkMode">Dark Mode</span>
          <label class="toggle-switch" aria-label="Toggle dark mode">
            <input type="checkbox" id="dark-mode-toggle"/>
            <span class="slider" aria-hidden="true"></span>
          </label>
        </div>

        <div class="setting-item">
          <label for="profile-language-select" class="setting-label" data-key="language">Language</label>
          <select id="profile-language-select" class="form-field" aria-label="Select language">
            <option value="en">English</option>
            <option value="am">አማርኛ</option>
          </select>
        </div>

        <div class="setting-buttons">
          <button class="glass-button small" type="button" onclick="exportCurrentEqub()">
            <span data-key="exportEqub">Export Current Equb</span>
          </button>
          <label for="import-file" class="glass-button small" style="display:inline-block;margin-left:10px;cursor:pointer;">
            <span data-key="importBtn">Import Equb</span>
          </label>
          <input type="file" id="import-file" accept=".json" style="display:none;"/>
          <button class="glass-button small" type="button" onclick="exportToPDF()" style="margin-top:8px;display:block;">
            <span data-key="exportPDF">Export to PDF</span>
          </button>
        </div>
      </div>

      <button id="logout-button" class="glass-button hidden" type="button" onclick="showConfirmation('logout')">
        <span data-key="logout">Logout</span>
      </button>
    </section>

    <!-- ====================== MODALS ====================== -->
    <!-- Create Equb -->
    <div id="create-equb-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="create-title">
      <div class="modal-content">
        <h2 id="create-title" data-key="createEqub">Create Equb</h2>

        <label for="create-equb-name" class="form-label" data-key="equbName">Equb Name</label>
        <input id="create-equb-name" class="form-field" placeholder="Enter equb name"/>

        <label for="create-equb-frequency" class="form-label" data-key="frequency">Frequency</label>
        <select id="create-equb-frequency" class="form-field" aria-label="Frequency">
          <option value="daily" data-key="daily">Daily</option>
          <option value="weekly" data-key="weekly">Weekly</option>
          <option value="monthly" data-key="monthly">Monthly</option>
          <option value="yearly" data-key="yearly">Yearly</option>
        </select>

        <label for="create-target-members" class="form-label" data-key="targetMembers">Target Members</label>
        <input id="create-target-members" type="number" class="form-field" min="2" placeholder="Minimum 2 members"/>

        <label for="create-goal-amount" class="form-label" data-key="goalAmount">Goal Amount (ETB)</label>
        <input id="create-goal-amount" type="number" class="form-field" min="1" placeholder="Enter goal amount"/>

        <label for="create-contribution-amount" class="form-label" data-key="contribution">Contribution (ETB)</label>
        <input id="create-contribution-amount" type="number" class="form-field" min="0" step="0.01" placeholder="Auto-calculated"/>

        <div class="auto-calculation-notice">
          <span data-key="autoCalculation">Contribution will be auto-calculated as: Goal Amount ÷ Target Members</span>
        </div>

        <label for="create-start-date" class="form-label" data-key="startDate">Start Date</label>
        <input id="create-start-date" type="date" class="form-field"/>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="createEqub()">
            <span data-key="create">Create</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('create-equb')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Equb -->
    <div id="edit-equb-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-title">
      <div class="modal-content">
        <h2 id="edit-title" data-key="editEqub">Edit Equb</h2>

        <label for="edit-equb-name" class="form-label" data-key="equbName">Equb Name</label>
        <input id="edit-equb-name" class="form-field" placeholder="Enter equb name"/>

        <label for="edit-equb-frequency" class="form-label" data-key="frequency">Frequency</label>
        <select id="edit-equb-frequency" class="form-field">
          <option value="daily" data-key="daily">Daily</option>
          <option value="weekly" data-key="weekly">Weekly</option>
          <option value="monthly" data-key="monthly">Monthly</option>
          <option value="yearly" data-key="yearly">Yearly</option>
        </select>

        <label for="edit-target-members" class="form-label" data-key="targetMembers">Target Members</label>
        <input id="edit-target-members" type="number" class="form-field" min="2" placeholder="Minimum 2 members"/>

        <label for="edit-goal-amount" class="form-label" data-key="goalAmount">Goal Amount (ETB)</label>
        <input id="edit-goal-amount" type="number" class="form-field" min="1" placeholder="Enter goal amount"/>

        <label for="edit-contribution-amount" class="form-label" data-key="contribution">Contribution (ETB)</label>
        <input id="edit-contribution-amount" type="number" class="form-field" min="0" step="0.01" placeholder="Enter contribution amount"/>

        <label for="edit-start-date" class="form-label" data-key="startDate">Start Date</label>
        <input id="edit-start-date" type="date" class="form-field"/>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="saveEditEqub()">
            <span data-key="save">Save</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('edit-equb')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Join Equb -->
    <div id="join-equb-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="join-title">
      <div class="modal-content">
        <h2 id="join-title" data-key="joinEqub">Join Equb</h2>

        <label for="equb-code" class="form-label" data-key="joinCode">Enter Code (EQ-XXXX-2025)</label>
        <input id="equb-code" class="form-field" inputmode="text" placeholder="EQ-XXXX-2025"/>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="joinEqub()">
            <span data-key="join">Join</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('join-equb')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Invite -->
    <div id="invite-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="invite-title">
      <div class="modal-content" style="text-align:center;">
        <h2 id="invite-title" data-key="invite">Invite to Equb</h2>
        <br>
        <p id="share-code" data-key="shareCode">Share this code:</p>
        <code id="invite-code" style="display:block;margin:10px 0;padding:8px;background:rgba(0,0,0,.2);border-radius:8px;"></code>
        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="copyInviteCode()">
            <span data-key="copy">Copy</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('invite')">
            <span data-key="close">Close</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Contribute -->
    <div id="contribute-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="contribute-title">
      <div class="modal-content">
        <h2 id="contribute-title" data-key="contribute">Contribute</h2>

        <label for="contribution-member" class="form-label" data-key="selectMember">Select Member</label>
        <select id="contribution-member" class="form-field"></select>

        <div id="required-amount-display" style="margin:10px 0;padding:10px;background:rgba(255,255,255,.1);border-radius:10px;display:none;">
          <p>
            <span data-key="required">Required:</span>
            <span id="required-amount"></span> 
            <span data-key="ETB">ETB (includes</span>
            <span id="missed-count"></span>
            <span data-key="missedDays">missed days)</span>
          </p>
        </div>

        <label for="contribute-amount" class="form-label" data-key="amount">Amount (ETB)</label>
        <input id="contribute-amount" type="number" class="form-field" min="0" step="0.01" placeholder="Enter amount"/>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="contribute()" id="contribute-submit">
            <span data-key="pay">Pay</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('contribute')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Add Member -->
    <div id="add-member-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="add-member-title">
      <div class="modal-content">
        <h2 id="add-member-title" data-key="addMember">Add Member</h2>

        <div class="form-row">
          <label for="add-member-name" class="form-label" data-key="memberName">Member Name</label>
          <input id="add-member-name" class="form-field" autocomplete="name" placeholder="Enter member name"/>
        </div>

        <div class="form-row">
          <label for="add-member-phone" class="form-label" data-key="phone">Phone Number</label>
          <input id="add-member-phone" class="form-field" type="tel" autocomplete="tel" placeholder="Enter phone number"/>
        </div>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="addMember()">
            <span data-key="add">Add</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('add-member')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Member -->
    <div id="edit-member-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-member-title">
      <div class="modal-content">
        <h2 id="edit-member-title" data-key="editMember">Edit Member</h2>

        <label for="edit-member-name" class="form-label" data-key="memberName">Member Name</label>
        <input id="edit-member-name" class="form-field" autocomplete="name" placeholder="Enter member name"/>

        <label for="edit-member-phone" class="form-label" data-key="phone">Phone Number</label>
        <input id="edit-member-phone" class="form-field" type="tel" autocomplete="tel" placeholder="Enter phone number"/>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="saveEditMember()">
            <span data-key="save">Save</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('edit-member')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Payout Modal -->
    <div id="payout-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="payout-title">
      <div class="modal-content">
        <h2 id="payout-title" data-key="payout">Payout Round</h2>

        <label for="payout-recipient" class="form-label" data-key="selectRecipient">Select Recipient</label>
        <select id="payout-recipient" class="form-field"></select>

        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="performPayout()" id="payout-submit">
            <span data-key="payout">Payout</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('payout')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Payout Order Modal -->
    <div id="edit-payout-order-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-payout-order-title">
      <div class="modal-content">
        <h2 id="edit-payout-order-title" data-key="editPayoutOrder">Edit Payout Order</h2>
        <p style="margin-bottom: 16px; opacity: 0.8;" data-key="dragReorder">
          Drag items or use buttons to reorder
        </p>
        <div id="payout-order-list" class="payout-order-list" role="list"></div>
        <div class="modal-buttons">
          <button class="glass-button" type="button" onclick="savePayoutOrder()">
            <span data-key="save">Save</span>
          </button>
          <button class="glass-button secondary" type="button" onclick="closeModal('edit-payout-order')">
            <span data-key="cancel">Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ====================== NAV BAR ====================== -->
    <nav class="nav-bar" id="nav-bar" style="display:none;" aria-label="Bottom navigation">
      <a class="nav-item" data-page="home" onclick="showPage('home')" aria-label="Home">
        <span class="material-symbols-rounded nav-icon" aria-hidden="true">home</span>
        <span class="nav-text" data-key="home">Home</span>
      </a>
      <a class="nav-item" data-page="myequbs" onclick="showPage('myequbs')" aria-label="My Equbs">
        <span class="material-symbols-rounded nav-icon" aria-hidden="true">account_balance</span>
        <span class="nav-text" data-key="myEqubs">My Equbs</span>
      </a>
      <a class="nav-item" data-page="members" onclick="showPage('members')" aria-label="Members">
        <span class="material-symbols-rounded nav-icon" aria-hidden="true">people</span>
        <span class="nav-text" data-key="members">Members</span>
      </a>
      <a class="nav-item" data-page="activity" onclick="showPage('activity')" aria-label="Activity">
        <span class="material-symbols-rounded nav-icon" aria-hidden="true">history</span>
        <span class="nav-text" data-key="activity">Activity</span>
      </a>
      <a class="nav-item" data-page="profile" onclick="showPage('profile')" aria-label="Profile">
        <span class="material-symbols-rounded nav-icon" aria-hidden="true">person</span>
        <span class="nav-text" data-key="profile">Profile</span>
      </a>
    </nav>
  </div>
 

  <script src="script.js"></script>
</body>
</html>
